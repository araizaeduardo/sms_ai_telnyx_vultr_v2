{% extends "base.html" %}

{% block title %}Calendario de Interacciones{% endblock %}

{% block extra_css %}
    <link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css' rel='stylesheet' />
    <link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.print.min.css' rel='stylesheet' media='print' />
    <style>
        .content-container {
            max-width: 100% !important;
            padding: 1rem;
        }

        #calendar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            margin: 20px auto;
        }

        /* Personalizaci√≥n del calendario */
        .fc-header-toolbar {
            padding: 1rem;
            margin-bottom: 1.5rem !important;
        }

        .fc-button {
            background: var(--dark-color) !important;
            border-color: var(--dark-color) !important;
            color: white !important;
            text-transform: capitalize;
            padding: 8px 15px !important;
            border-radius: 5px !important;
            transition: all 0.3s ease;
        }

        .fc-button:hover {
            opacity: 0.9;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .fc-today-button {
            background: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
        }

        .fc-state-active {
            background: var(--secondary-color) !important;
            border-color: var(--secondary-color) !important;
        }

        /* Estilos para los eventos */
        .fc-event {
            border: none !important;
            padding: 3px 5px !important;
            border-radius: 4px !important;
            margin: 2px 0 !important;
            transition: transform 0.2s ease;
        }

        .fc-event:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Estados de los eventos */
        .estado-pendiente {
            background-color: #FF9F1C !important;
            border-left: 4px solid #cc7f16 !important;
        }

        .estado-proceso {
            background-color: #2EC4B6 !important;
            border-left: 4px solid #238e84 !important;
        }

        .estado-revision {
            background-color: #E71D36 !important;
            border-left: 4px solid #b8162b !important;
        }

        .estado-completado {
            background-color: #011627 !important;
            border-left: 4px solid #000a12 !important;
        }

        /* Estilos para el d√≠a actual */
        .fc-today {
            background-color: #f8f9fa !important;
            border: 2px solid var(--primary-color) !important;
        }

        /* Estilos para los encabezados */
        .fc-widget-header {
            background-color: #f8f9fa;
            padding: 10px 0 !important;
            font-weight: bold;
            color: var(--dark-color);
        }

        /* Tooltip personalizado */
        .tooltip {
            position: absolute;
            background: white;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 0.9em;
            max-width: 300px;
            z-index: 1000;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .fc-header-toolbar {
                flex-direction: column;
                gap: 10px;
            }

            .fc-toolbar-chunk {
                display: flex;
                justify-content: center;
                width: 100%;
            }

            .fc-button-group {
                width: 100%;
                display: flex !important;
                justify-content: center;
            }

            .fc-button {
                padding: 6px 12px !important;
                font-size: 0.9em !important;
            }
        }
    </style>
{% endblock %}

{% block content %}
    <div id="calendar"></div>
{% endblock %}

{% block extra_js %}
    <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/locale/es.js'></script>
    <script>
        $(document).ready(function() {
            $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                locale: 'es',
                navLinks: true,
                editable: false,
                eventLimit: true,
                events: [
                    {% for cliente in clientes %}
                    {
                        title: '{{ cliente[2] }} - {{ cliente[6] }}',
                        start: '{{ cliente[5] }}',
                        description: '{{ cliente[3] }}',
                        url: '/detalle/{{ cliente[0] }}',
                        className: 'estado-{{ cliente[6]|lower|replace(" ", "") }}'
                    },
                    {% endfor %}
                ],
                eventClick: function(event) {
                    if (event.url) {
                        window.location.href = event.url;
                        return false;
                    }
                },
                eventRender: function(event, element) {
                    element.attr('title', event.description);
                    
                    // Agregar icono seg√∫n el estado
                    var statusIcon = 'üì±';
                    element.find('.fc-title').prepend(statusIcon + ' ');
                },
                viewRender: function(view, element) {
                    // A√±adir clases adicionales para mejorar la visualizaci√≥n
                    $('.fc-day-number').addClass('fw-bold');
                    $('.fc-day-header').addClass('text-uppercase');
                }
            });
        });
    </script>
{% endblock %}
